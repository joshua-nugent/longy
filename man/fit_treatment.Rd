% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fit_treatment.R
\name{fit_treatment}
\alias{fit_treatment}
\title{Fit Treatment Models (g_A)}
\usage{
fit_treatment(
  obj,
  regime = NULL,
  covariates = NULL,
  learners = NULL,
  sl_control = list(),
  adaptive_cv = TRUE,
  min_obs = 50L,
  min_events = 20L,
  bounds = c(0.005, 0.995),
  times = NULL,
  sl_fn = "SuperLearner",
  verbose = TRUE,
  refit = FALSE
)
}
\arguments{
\item{obj}{A \code{longy_data} object with at least one regime defined.}

\item{regime}{Character. Name of the regime to fit for.}

\item{covariates}{Character vector. Column names to use as predictors.
If NULL, uses all baseline + timevarying covariates.}

\item{learners}{Character vector. SuperLearner library names.
If NULL, uses glm only.}

\item{sl_control}{List. Additional arguments passed to SuperLearner.}

\item{adaptive_cv}{Logical. Use adaptive CV fold selection based on effective
sample size.}

\item{min_obs}{Integer. Minimum observations to fit a model; below this
threshold, uses marginal mean.}

\item{min_events}{Integer. Minimum minority-class events required to fit a
model. When the minority class count is below this AND the minority rate
is below 0.01, marginal fallback is used. Default 20.}

\item{bounds}{Numeric vector of length 2. Bounds for predicted probabilities.}

\item{times}{Numeric vector. If provided, only fit models through
\code{max(times)}. Saves computation when estimation is only needed at
early time points.}

\item{sl_fn}{Character. SuperLearner implementation: \code{"SuperLearner"}
(default) or \code{"ffSL"} (future-factorial parallel).}

\item{verbose}{Logical. Print progress.}

\item{refit}{Logical. If FALSE (default), errors when treatment is already
fitted for the requested regime(s). Set to TRUE to re-fit.}
}
\value{
Modified \code{longy_data} object with treatment fits stored.
}
\description{
Fits propensity score models P(A(t) = 1 | past) at each time point for
subjects in the risk set (regime-consistent and uncensored through t-1).
}
