% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/data_input.R
\name{longy_data}
\alias{longy_data}
\title{Create a longy_data Object for Longitudinal Causal Inference}
\usage{
longy_data(
  data,
  id,
  time,
  outcome,
  treatment,
  censoring = NULL,
  observation = NULL,
  baseline = character(0),
  timevarying = character(0),
  sampling_weights = NULL,
  outcome_type = "binary",
  competing = NULL,
  verbose = TRUE
)
}
\arguments{
\item{data}{A data.frame or data.table in long format (one row per subject-time).}

\item{id}{Character. Column name for subject identifier.}

\item{time}{Character. Column name for time index (integer).}

\item{outcome}{Character. Column name for the outcome variable.}

\item{treatment}{Character. Column name for binary treatment (0/1).}

\item{censoring}{Character (length 1). Column name for a character/factor
censoring status column. The column must contain \code{"uncensored"} for
rows where the subject is not censored; any other value (e.g.
\code{"censored"}, \code{"death"}, \code{"ltfu"}) is treated as a
distinct censoring cause. Censoring is absorbing: once a subject has a
non-\code{"uncensored"} value, they should have no further rows (or all
subsequent rows should also be non-\code{"uncensored"}).

Each non-\code{"uncensored"} level is automatically decomposed into an
internal binary indicator column (named \code{.cens_<cause>}) and modeled
separately by \code{\link{fit_censoring}}. The internal column names are
stored in \code{nodes$censoring}; the original column name and cause
labels are in \code{nodes$censoring_col} and \code{nodes$censoring_levels}.

NAs are not allowed in the censoring column. If all values are
\code{"uncensored"}, censoring is treated as NULL (no censoring).
NULL if no censoring column exists.}

\item{observation}{Character. Column name for intermittent outcome
measurement indicator (1 = observed). Subject can return after R=0.
If NULL, auto-detected from NA values in the outcome column among
uncensored rows. If NAs are found, an observation column is created
automatically.}

\item{baseline}{Character vector. Column names for time-invariant covariates.}

\item{timevarying}{Character vector. Column names for time-varying covariates.}

\item{sampling_weights}{Character. Column name for external sampling/survey
weights (e.g., to generalize from the study to a target population). Must
be non-negative (zero allowed to exclude subjects) and constant within
subject. These weights are used in nuisance model fitting (as observation
weights in glm/SuperLearner), in computing marginal rates for stabilized
weights, and multiply the final IPW weight. Follows ltmle's
\code{observation.weights} convention. NULL if none.}

\item{outcome_type}{Character. One of \code{"binary"}, \code{"continuous"}, \code{"survival"}.}

\item{competing}{Character. Column name for a binary absorbing competing
event indicator (1 = competing event occurred). Once D=1, must remain 1.
Used with \code{outcome_type = "survival"} to estimate cause-specific
cumulative incidence. Subjects who experience the competing event are
excluded from the risk set with Q hard-coded to 0. NULL if no competing
risks.}

\item{verbose}{Logical. Print progress messages.}
}
\value{
An S3 object of class \code{"longy_data"}, a list with components:
\describe{
\item{data}{A \code{data.table} keyed on (id, time), including any
internal columns created during validation (e.g. \code{.cens_*},
\code{.obs}).}
\item{nodes}{A list of column name mappings: \code{id}, \code{time},
\code{outcome}, \code{treatment}, \code{censoring} (internal binary
column names or NULL), \code{censoring_col} (original column name or
NULL), \code{censoring_levels} (cause labels or NULL),
\code{observation}, \code{sampling_weights}, \code{baseline},
\code{timevarying}, \code{outcome_type}, \code{competing}.}
\item{regimes}{Initially empty list; populated by
\code{\link{define_regime}}.}
\item{fits}{Initially empty; populated by \code{fit_treatment},
\code{fit_censoring}, \code{fit_observation}.}
\item{weights}{NULL until \code{\link{compute_weights}} is called.}
\item{crossfit}{Cross-fitting configuration (enabled, n_folds,
fold_id).}
\item{meta}{Dataset metadata: n_subjects, n_obs, n_times, time_values,
max_time, min_time.}
}
}
\description{
Constructs and validates a \code{longy_data} S3 object from a long-format dataset
(one row per subject-time). This is the entry point for the longy pipeline.
}
\examples{
\dontrun{
# Single censoring cause (C has values "uncensored" and "censored")
obj <- longy_data(
  data = sim_longy,
  id = "id", time = "time", outcome = "Y",
  treatment = "A", censoring = "C", observation = "R",
  baseline = c("W1", "W2"), timevarying = c("L1", "L2")
)
obj$nodes$censoring       # ".cens_censored"
obj$nodes$censoring_col   # "C"

# Multiple censoring causes (C has values "uncensored", "death", "ltfu")
obj2 <- longy_data(
  data = my_data,
  id = "id", time = "time", outcome = "Y",
  treatment = "A", censoring = "C_status",
  baseline = c("W1", "W2"), timevarying = c("L1", "L2")
)
obj2$nodes$censoring       # c(".cens_death", ".cens_ltfu")
obj2$nodes$censoring_levels # c("death", "ltfu")
}

}
